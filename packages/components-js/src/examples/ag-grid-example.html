<script type="module">
  const theme = new URL(document.location).searchParams.get('theme') || 'light';

  const grid = document.querySelector('#my-grid');

  grid.classList.add(`ag-theme-pds${theme === 'dark' ? '-dark' : ''}`);

  class ImageUrlRenderer {
    eGui;

    // Optional: Params for rendering. The same params that are passed to the cellRenderer function.
    init(params) {
      let imageElement = document.createElement('img');

      imageElement.src = params.value.replace('/porsche-design-system/', '/dummyasset/'); // TODO: why is this needed?
      imageElement.style = 'margin-inline-end: 8px; object-fit: contain;';
      imageElement.width = 80;
      imageElement.height = 45;

      this.eGui = imageElement;
    }

    // Required: Return the DOM element of the component, this is what the grid puts into the cell
    getGui() {
      return this.eGui;
    }

    // Required: Get the cell to refresh.
    refresh(params) {
      return false;
    }
  }

  class ButtonRenderer {
    eGui;

    // Optional: Params for rendering. The same params that are passed to the cellRenderer function.
    init(params) {
      let spanElement = document.createElement('span');
      spanElement.classList.add('cell__centered');

      let linkElement = document.createElement('p-link');
      linkElement.href = 'https://www.porsche.com';
      linkElement.innerHTML = 'Some value';
      linkElement.compact = true;

      spanElement.appendChild(linkElement);

      this.eGui = spanElement;
    }

    // Required: Return the DOM element of the component, this is what the grid puts into the cell
    getGui() {
      return this.eGui;
    }

    // Required: Get the cell to refresh.
    refresh(params) {
      return false;
    }
  }

  const dataAdvanced = [
    {
      test: 'Disabled',
      imageUrl: 'https://porsche-design-system.github.io/dummyasset/718.png',
      model: '718',
      date: '23.06.2021',
      interest: 'New Car',
      vin: '1FM5K7F84FGB16304',
      purchaseIntention: '08/2021',
      status: 'Won',
      comment: '-',
      leadId: '0000824402',
    },
    {
      test: 'test',
      imageUrl: 'https://porsche-design-system.github.io/dummyasset/panamera.png',
      model: 'Panamera',
      date: '19.06.2021',
      interest: 'New Car',
      vin: '2GCEC13T141374801',
      purchaseIntention: '11/2021',
      status: 'Lost',
      comment: 'Some multiline text and a column with a min width.',
      leadId: '0000824409',
    },
    {
      test: 'test',
      imageUrl: 'https://porsche-design-system.github.io/dummyasset/911.png',
      model: '911',
      date: '19.05.2021',
      interest: 'Used Car',
      vin: '5GAKVCKD8EJ335750',
      purchaseIntention: '09/2021',
      status: 'Won',
      comment: '-',
      leadId: '0000824408',
    },
    {
      test: 'test',
      imageUrl: 'https://porsche-design-system.github.io/dummyasset/macan.png',
      model: 'Macan',
      date: '10.05.2021',
      interest: 'Used Car',
      vin: '1FMPU17L83LC09302',
      purchaseIntention: '07/2021',
      status: 'Lost',
      comment: '-',
      leadId: '0000824407',
    },
    {
      test: 'test',
      imageUrl: 'https://porsche-design-system.github.io/dummyasset/taycan.png',
      model: 'Taycan',
      date: '03.05.2021',
      interest: 'New Car',
      vin: 'JN1BY1AR3BM375187',
      purchaseIntention: '05/2021',
      status: 'Won',
      comment: '-',
      leadId: '0000824406',
    },
  ];

  const gridOptions = {
    isRowSelectable: (params) => {
      return !!params.data && params.data.test !== 'Disabled';
    },
    // Data to be displayed
    rowData: dataAdvanced,
    // Columns to be displayed (Should match rowData properties)
    columnDefs: [
      {
        field: 'test',
        checkboxSelection: true,
        showDisabledCheckboxes: true,
        rowGroup: true,
      },
      {
        field: 'imageUrl',
        cellRenderer: ImageUrlRenderer,
      },
      {
        field: 'model',
        editable: false,
      },
      {
        field: 'date',
      },
      {
        field: 'interest',
      },
      {
        field: 'vin',
      },
      {
        field: 'purchaseIntention',
      },
      {
        field: 'status',
      },
      {
        field: 'comment',
      },
      {
        field: 'leadId',
        cellRenderer: ButtonRenderer,
      },
    ],
    // Configurations applied to all columns
    defaultColDef: {
      filter: true,
      editable: true,
    },
    // Grid Options & Callbacks
    pagination: true,
    sideBar: true,
    // loading: true,
    enableRangeSelection: true,
  };

  window.agGrid.createGrid(grid, gridOptions);
</script>

<div id="my-grid" style="height: 80vh; padding: 1rem"></div>

<style>
  .cell__centered {
    height: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
</style>
